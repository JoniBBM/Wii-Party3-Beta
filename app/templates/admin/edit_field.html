{% extends "base.html" %}

{% block title %}Feld bearbeiten: {{ config.display_name if config else field_type }} - Admin Dashboard{% endblock %}

{% block styles %}
{{ super() }}
<style>
    /* Admin Dashboard Theme - Dark Professional */
    .admin-dashboard-container {
        background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
        min-height: 100vh;
        color: white;
        position: relative;
        padding: 0;
        margin: 0;
        overflow-x: hidden;
        overflow-y: auto;
        -webkit-overflow-scrolling: touch;
    }

    .admin-dashboard-container::before {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(45deg, rgba(52, 73, 94, 0.1) 25%, transparent 25%),
                    linear-gradient(-45deg, rgba(52, 73, 94, 0.1) 25%, transparent 25%),
                    linear-gradient(45deg, transparent 75%, rgba(52, 73, 94, 0.1) 75%),
                    linear-gradient(-45deg, transparent 75%, rgba(52, 73, 94, 0.1) 75%);
        background-size: 60px 60px;
        background-position: 0 0, 0 30px, 30px -30px, -30px 0px;
        animation: movePattern 20s linear infinite;
        opacity: 0.15;
        z-index: -1;
        pointer-events: none;
    }

    @keyframes movePattern {
        0% { transform: translateX(0px) translateY(0px); }
        100% { transform: translateX(60px) translateY(60px); }
    }

    .admin-content {
        position: relative;
        z-index: 2;
        padding: 2rem 0;
        min-height: 100vh;
    }

    .admin-content .container {
        max-width: 1200px;
        padding-left: 1.5rem;
        padding-right: 1.5rem;
    }

    /* Card styling */
    .card {
        background: rgba(44, 62, 80, 0.15);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 18px;
        backdrop-filter: blur(15px);
        box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
        color: white;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        overflow: hidden;
        margin-bottom: 2rem;
    }

    .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 25px 50px rgba(0, 0, 0, 0.4);
        border-color: rgba(255, 255, 255, 0.2);
    }

    .card-header {
        background: rgba(52, 152, 219, 0.2) !important;
        border-bottom: 1px solid rgba(52, 152, 219, 0.3);
        border-radius: 18px 18px 0 0;
        padding: 1.5rem 2rem;
    }

    .card-header h4 {
        margin: 0;
        font-weight: 700;
        color: white;
    }

    .card-body {
        padding: 2rem;
    }

    /* Alert styling */
    .alert {
        border-radius: 15px;
        border: none;
        padding: 1rem 1.5rem;
        backdrop-filter: blur(10px);
        font-weight: 500;
        margin-bottom: 1.5rem;
    }

    .alert-success {
        background: rgba(39, 174, 96, 0.2);
        border: 1px solid rgba(39, 174, 96, 0.3);
        color: white;
    }

    .alert-danger {
        background: rgba(231, 76, 60, 0.2);
        border: 1px solid rgba(231, 76, 60, 0.3);
        color: white;
    }

    .alert-warning {
        background: rgba(241, 196, 15, 0.2);
        border: 1px solid rgba(241, 196, 15, 0.3);
        color: white;
    }

    .alert-info {
        background: rgba(26, 188, 156, 0.2);
        border: 1px solid rgba(26, 188, 156, 0.3);
        color: white;
    }

    /* Form styling */
    .form-group {
        margin-bottom: 1.5rem;
    }

    .form-control-label {
        color: white;
        font-weight: 600;
        margin-bottom: 0.5rem;
        display: block;
    }

    .form-control {
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 10px;
        color: white;
        padding: 12px 16px;
        transition: all 0.3s ease;
    }

    .form-control:focus {
        background: rgba(255, 255, 255, 0.15);
        border-color: rgba(52, 152, 219, 0.5);
        box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        color: white;
    }

    .form-control::placeholder {
        color: rgba(255, 255, 255, 0.6);
    }

    .form-text {
        color: rgba(255, 255, 255, 0.7) !important;
        font-size: 0.875rem;
        margin-top: 0.25rem;
    }

    .invalid-feedback {
        color: #e74c3c;
        font-weight: 500;
    }

    .form-control.is-invalid {
        border-color: #e74c3c;
        background: rgba(231, 76, 60, 0.1);
    }

    /* Input group styling */
    .input-group {
        margin-bottom: 1rem;
    }

    .input-group-text {
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        color: rgba(255, 255, 255, 0.8);
        border-radius: 10px 0 0 10px;
    }

    .input-group .form-control {
        border-radius: 0 10px 10px 0;
    }

    /* Button styling */
    .btn {
        border-radius: 10px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        transition: all 0.3s ease;
        border: none;
        padding: 12px 24px;
    }

    .btn:hover {
        transform: translateY(-2px);
    }

    .btn-primary {
        background: linear-gradient(45deg, #3498db, #2980b9);
        color: white;
        box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
    }

    .btn-primary:hover {
        background: linear-gradient(45deg, #2980b9, #21618c);
        color: white;
        box-shadow: 0 8px 20px rgba(52, 152, 219, 0.4);
    }

    .btn-outline-light {
        border: 2px solid rgba(255, 255, 255, 0.7);
        color: rgba(255, 255, 255, 0.9);
        background: transparent;
    }

    .btn-outline-light:hover {
        background: rgba(255, 255, 255, 0.1);
        color: white;
        border-color: white;
        box-shadow: 0 5px 15px rgba(255, 255, 255, 0.2);
    }

    .btn-danger {
        background: linear-gradient(45deg, #e74c3c, #c0392b);
        color: white;
        box-shadow: 0 5px 15px rgba(231, 76, 60, 0.3);
    }

    .btn-danger:hover {
        background: linear-gradient(45deg, #c0392b, #a93226);
        color: white;
        box-shadow: 0 8px 20px rgba(231, 76, 60, 0.4);
    }

    .btn-secondary {
        background: linear-gradient(45deg, #95a5a6, #7f8c8d);
        color: white;
        box-shadow: 0 5px 15px rgba(149, 165, 166, 0.3);
    }

    .btn-secondary:hover {
        background: linear-gradient(45deg, #7f8c8d, #6c7b7d);
        color: white;
        box-shadow: 0 8px 20px rgba(149, 165, 166, 0.4);
    }

    .btn-sm {
        padding: 8px 16px;
        font-size: 0.85rem;
    }

    /* Color picker styling */
    input[type="color"] {
        width: 50px;
        height: 40px;
        border: 2px solid rgba(255, 255, 255, 0.2);
        border-radius: 10px;
        background: transparent;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    input[type="color"]:hover {
        border-color: rgba(255, 255, 255, 0.5);
        transform: scale(1.1);
    }

    /* Section styling */
    .config-section {
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 15px;
        padding: 1.5rem;
        margin-bottom: 2rem;
    }

    .section-title {
        color: #3498db;
        font-weight: 600;
        margin-bottom: 1rem;
        font-size: 1.1rem;
        border-bottom: 1px solid rgba(52, 152, 219, 0.3);
        padding-bottom: 0.5rem;
    }

    /* Preview area styling */
    .preview-area {
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 15px;
        padding: 1.5rem;
        text-align: center;
        min-height: 150px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    /* Close button for alerts */
    .close {
        color: rgba(255, 255, 255, 0.8);
        text-shadow: none;
        opacity: 0.8;
    }

    .close:hover {
        color: white;
        opacity: 1;
    }

    /* Text colors */
    .text-muted {
        color: rgba(255, 255, 255, 0.6) !important;
    }

    /* Edit field specific styles */\n    .field-preview {\n        transition: all 0.3s ease;\n        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);\n        border-radius: 10px;\n        padding: 1rem;\n        background: rgba(255, 255, 255, 0.05);\n        border: 1px solid rgba(255, 255, 255, 0.1);\n    }\n\n    .color-preview {\n        transition: all 0.3s ease;\n        border-radius: 8px;\n        cursor: pointer;\n    }\n\n    .color-preview:hover {\n        transform: scale(1.1);\n        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);\n    }\n\n    .form-check-lg .form-check-input {\n        transform: scale(1.3);\n        margin-right: 0.75rem;\n    }\n\n    .form-check-lg .form-check-label {\n        font-size: 1.1em;\n        font-weight: 500;\n        color: rgba(255, 255, 255, 0.9);\n    }\n\n    .form-actions {\n        border-top: 1px solid rgba(255, 255, 255, 0.2);\n        padding-top: 1.5rem;\n        margin-top: 1.5rem;\n    }\n\n    /* Badge styling for field types */\n    .badge {\n        font-size: 0.8em;\n        border-radius: 15px;\n        padding: 0.4rem 0.8rem;\n        font-weight: 600;\n        text-transform: uppercase;\n        letter-spacing: 0.5px;\n    }\n\n    .badge-primary {\n        background: linear-gradient(45deg, #3498db, #2980b9);\n        color: white;\n    }\n\n    .badge-success {\n        background: linear-gradient(45deg, #27ae60, #229954);\n        color: white;\n    }\n\n    .badge-warning {\n        background: linear-gradient(45deg, #f1c40f, #f39c12);\n        color: #2c3e50;\n    }\n\n    .badge-danger {\n        background: linear-gradient(45deg, #e74c3c, #c0392b);\n        color: white;\n    }\n\n    /* Range slider styling */\n    input[type=\"range\"] {\n        -webkit-appearance: none;\n        width: 100%;\n        height: 8px;\n        border-radius: 10px;\n        background: rgba(255, 255, 255, 0.2);\n        outline: none;\n    }\n\n    input[type=\"range\"]::-webkit-slider-thumb {\n        -webkit-appearance: none;\n        appearance: none;\n        width: 20px;\n        height: 20px;\n        border-radius: 50%;\n        background: linear-gradient(45deg, #3498db, #2980b9);\n        cursor: pointer;\n        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);\n    }\n\n    input[type=\"range\"]::-moz-range-thumb {\n        width: 20px;\n        height: 20px;\n        border-radius: 50%;\n        background: linear-gradient(45deg, #3498db, #2980b9);\n        cursor: pointer;\n        border: none;\n        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);\n    }\n\n    /* Checkbox styling */\n    .form-check-input {\n        width: 1.25em;\n        height: 1.25em;\n        background-color: rgba(255, 255, 255, 0.1);\n        border: 2px solid rgba(255, 255, 255, 0.3);\n        border-radius: 6px;\n        transition: all 0.3s ease;\n    }\n\n    .form-check-input:checked {\n        background-color: #3498db;\n        border-color: #3498db;\n    }\n\n    .form-check-input:focus {\n        box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);\n    }\n\n    .form-check-label {\n        color: rgba(255, 255, 255, 0.9);\n        margin-left: 0.5rem;\n    }\n\n    @media (max-width: 768px) {\n        .admin-content .container {\n            padding-left: 1rem;\n            padding-right: 1rem;\n        }\n\n        .card-body, .card-header {\n            padding: 1.5rem;\n        }\n\n        .d-flex.justify-content-between {\n            flex-direction: column;\n            gap: 1rem;\n        }\n\n        .btn-outline-light {\n            width: 100%;\n        }\n\n        .config-section {\n            padding: 1rem;\n        }\n\n        input[type=\"color\"] {\n            width: 40px;\n            height: 35px;\n        }\n    }
</style>
{% endblock %}

{% block content %}
<div class="admin-dashboard-container">
    <div class="admin-content">
        <div class="container">
    <div class="row">
        <div class="col-lg-8">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <div class="d-flex justify-content-between align-items-center">
                        <h4 class="mb-0">
                            <i class="fas fa-edit"></i> 
                            {% if config %}
                                {{ config.display_name }} bearbeiten
                            {% else %}
                                Neuen Feld-Typ erstellen: {{ field_type }}
                            {% endif %}
                        </h4>
                        <a href="{{ url_for('admin.manage_fields') }}" class="btn btn-outline-light">
                            <i class="fas fa-arrow-left"></i> Zurück
                        </a>
                    </div>
                </div>
                <div class="card-body">
                    <!-- Flash Nachrichten -->
                    {% with messages = get_flashed_messages(with_categories=true) %}
                        {% if messages %}
                            {% for category, message in messages %}
                            <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                                {{ message }}
                                <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            {% endfor %}
                        {% endif %}
                    {% endwith %}

                    <form method="POST" action="{{ url_for('admin.edit_field', field_type=field_type) }}" novalidate>
                        {{ form.hidden_tag() }}
                        
                        <!-- Basis-Informationen -->
                        <div class="form-section mb-4">
                            <h5 class="section-title">
                                <i class="fas fa-info-circle"></i> Basis-Informationen
                            </h5>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        {{ form.display_name.label(class="form-control-label") }}
                                        {{ form.display_name(class="form-control" + (" is-invalid" if form.display_name.errors else "")) }}
                                        {% if form.display_name.errors %}
                                            <div class="invalid-feedback">
                                                {% for error in form.display_name.errors %}{{ error }}{% endfor %}
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        {{ form.icon.label(class="form-control-label") }}
                                        <div class="input-group">
                                            {{ form.icon(class="form-control", placeholder="z.B. 🚀, ⭐, 🎮") }}
                                            <div class="input-group-append">
                                                <span class="input-group-text" id="icon-preview">
                                                    {{ form.icon.data if form.icon.data else '❓' }}
                                                </span>
                                            </div>
                                        </div>
                                        <small class="form-text text-muted">
                                            Emoji oder Unicode-Symbol für bessere Erkennbarkeit
                                        </small>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                {{ form.description.label(class="form-control-label") }}
                                {{ form.description(class="form-control", rows="2") }}
                                <small class="form-text text-muted">
                                    Beschreibung der Funktion dieses Feld-Typs
                                </small>
                            </div>
                            
                            <div class="form-check form-check-lg">
                                {{ form.is_enabled(class="form-check-input", id="is_enabled") }}
                                {{ form.is_enabled.label(class="form-check-label", for="is_enabled") }}
                                <small class="form-text text-muted">
                                    Deaktivierte Felder werden nicht auf dem Spielfeld platziert
                                </small>
                            </div>
                        </div>

                        <!-- Häufigkeits-Konfiguration -->
                        <div class="form-section mb-4">
                            <h5 class="section-title">
                                <i class="fas fa-chart-pie"></i> Häufigkeits-Konfiguration
                            </h5>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        {{ form.frequency_type.label(class="form-control-label") }}
                                        {{ form.frequency_type(class="form-control", id="frequency_type") }}
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        {{ form.frequency_value.label(class="form-control-label", id="frequency_value_label") }}
                                        {{ form.frequency_value(class="form-control", id="frequency_value") }}
                                        <small class="form-text text-muted" id="frequency_help">
                                            Bestimmt wie oft dieses Feld auf dem Spielbrett erscheint
                                        </small>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Feste Positionen (nur bei frequency_type = 'fixed_positions') -->
                            <div class="form-group" id="fixed_positions_group" style="display: none;">
                                {{ form.fixed_positions.label(class="form-control-label") }}
                                {{ form.fixed_positions(class="form-control", placeholder="z.B. 15,30,45,60") }}
                                <small class="form-text text-muted">
                                    Komma-getrennte Liste von Positionen (0-72)
                                </small>
                            </div>
                        </div>

                        <!-- Farb-Konfiguration -->
                        <div class="form-section mb-4">
                            <h5 class="section-title">
                                <i class="fas fa-palette"></i> Farb-Konfiguration
                            </h5>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        {{ form.color_hex.label(class="form-control-label") }}
                                        <div class="input-group">
                                            {{ form.color_hex(class="form-control", id="color_hex") }}
                                            <div class="input-group-append">
                                                <div class="input-group-text color-preview" id="color-preview" 
                                                     style="background-color: {{ form.color_hex.data or '#81C784' }}; width: 40px;">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        {{ form.emission_hex.label(class="form-control-label") }}
                                        <div class="input-group">
                                            {{ form.emission_hex(class="form-control", id="emission_hex") }}
                                            <div class="input-group-append">
                                                <div class="input-group-text color-preview" id="emission-preview" 
                                                     style="background-color: {{ form.emission_hex.data or '#4CAF50' }}; width: 40px;">
                                                </div>
                                            </div>
                                        </div>
                                        <small class="form-text text-muted">
                                            Wird für Glüh-Effekte und Hervorhebungen verwendet
                                        </small>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Feldspezifische Konfigurationen -->
                        {% if template_info and template_info.config_fields %}
                        <div class="form-section mb-4">
                            <h5 class="section-title">
                                <i class="fas fa-cogs"></i> Spezielle Einstellungen für {{ field_type }}
                            </h5>
                            
                            {% for field_config in template_info.config_fields %}
                                <div class="form-group">
                                    {% if field_config.type == 'number' %}
                                        <label for="{{ field_config.name }}" class="form-control-label">{{ field_config.label }}</label>
                                        <input type="number" class="form-control" id="{{ field_config.name }}" 
                                               name="{{ field_config.name }}" value="{{ config.config_dict.get(field_config.name, field_config.default) }}"
                                               min="1" max="20">
                                    {% elif field_config.type == 'text' %}
                                        <label for="{{ field_config.name }}" class="form-control-label">{{ field_config.label }}</label>
                                        {% set current_value = config.config_dict.get(field_config.name, field_config.default) %}
                                        {% if field_config.name == 'target_numbers' %}
                                            {% if current_value is string %}
                                                {% set display_value = current_value %}
                                            {% elif current_value is iterable and current_value is not string %}
                                                {% set display_value = current_value|join(',') %}
                                            {% else %}
                                                {% set display_value = field_config.default %}
                                            {% endif %}
                                        {% else %}
                                            {% set display_value = current_value if current_value else field_config.default %}
                                        {% endif %}
                                        <input type="text" class="form-control" id="{{ field_config.name }}" 
                                               name="{{ field_config.name }}" value="{{ display_value|e }}"
                                               placeholder="{{ field_config.get('placeholder', '') }}">
                                        {% if field_config.name == 'target_numbers' %}
                                        <small class="form-text text-muted">
                                            <strong>Beispiele:</strong><br>
                                            • <code>-3</code> = Würfle 1, 2 oder 3 (höchstens 3)<br>
                                            • <code>5+</code> = Würfle 5 oder 6 (mindestens 5)<br>
                                            • <code>6</code> = Nur 6 befreit<br>
                                            • <code>2,4,6</code> = Nur gerade Zahlen<br>
                                            • <code>4,5,6</code> = Standard (mittel)
                                        </small>
                                        {% endif %}
                                    {% elif field_config.type == 'select' %}
                                        <label for="{{ field_config.name }}" class="form-control-label">{{ field_config.label }}</label>
                                        <select class="form-control" id="{{ field_config.name }}" name="{{ field_config.name }}">
                                            {% set current_select_value = config.config_dict.get(field_config.name, field_config.default) %}
                                            {% for option_value, option_label in field_config.options %}
                                                <option value="{{ option_value }}" 
                                                        {% if option_value == current_select_value %}selected{% endif %}>
                                                    {{ option_label }}
                                                </option>
                                            {% endfor %}
                                        </select>
                                    {% elif field_config.type == 'multiselect' %}
                                        <label class="form-control-label">{{ field_config.label }}</label>
                                        {% set current_multi_values = config.config_dict.get(field_config.name, field_config.default) %}
                                        {% for option_value, option_label in field_config.options %}
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" 
                                                       name="{{ field_config.name }}" value="{{ option_value }}"
                                                       id="{{ field_config.name }}_{{ option_value }}"
                                                       {% if option_value in current_multi_values %}checked{% endif %}>
                                                <label class="form-check-label" for="{{ field_config.name }}_{{ option_value }}">
                                                    {{ option_label }}
                                                </label>
                                            </div>
                                        {% endfor %}
                                    {% endif %}
                                </div>
                            {% endfor %}
                        </div>
                        {% endif %}

                        <!-- Feld-Minigame Management (nur für minigame Felder) -->
                        {% if field_type == 'minigame' %}
                        <div class="form-section mb-4">
                            <h5 class="section-title">
                                <i class="fas fa-gamepad"></i> Feld-Minigame Management
                            </h5>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="card">
                                        <div class="card-header bg-primary text-white">
                                            <h6 class="mb-0">
                                                <i class="fas fa-users"></i> Team vs Alle
                                            </h6>
                                        </div>
                                        <div class="card-body">
                                            <p class="text-muted small">Ein Team spielt gegen alle anderen Teams</p>
                                            <div id="team-vs-all-content">
                                                <div class="d-flex justify-content-between align-items-center mb-2">
                                                    <span>Verfügbare Minigames:</span>
                                                    <span class="badge badge-info" id="team-vs-all-count">Lädt...</span>
                                                </div>
                                                <button type="button" class="btn btn-sm btn-outline-primary" 
                                                        onclick="openMinigameEditor('team_vs_all')">
                                                    <i class="fas fa-edit"></i> Verwalten
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="col-md-6">
                                    <div class="card">
                                        <div class="card-header bg-success text-white">
                                            <h6 class="mb-0">
                                                <i class="fas fa-user-friends"></i> Team vs Team
                                            </h6>
                                        </div>
                                        <div class="card-body">
                                            <p class="text-muted small">Ein Team spielt gegen ein anderes Team</p>
                                            <div id="team-vs-team-content">
                                                <div class="d-flex justify-content-between align-items-center mb-2">
                                                    <span>Verfügbare Minigames:</span>
                                                    <span class="badge badge-info" id="team-vs-team-count">Lädt...</span>
                                                </div>
                                                <button type="button" class="btn btn-sm btn-outline-success" 
                                                        onclick="openMinigameEditor('team_vs_team')">
                                                    <i class="fas fa-edit"></i> Verwalten
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row mt-3">
                                <div class="col-12">
                                    <div class="card">
                                        <div class="card-header bg-warning text-dark">
                                            <h6 class="mb-0">
                                                <i class="fas fa-cog"></i> Feld-Minigame Einstellungen
                                            </h6>
                                        </div>
                                        <div class="card-body">
                                            <div class="row">
                                                <div class="col-md-4">
                                                    <div class="form-group">
                                                        <label for="reward_forward">Belohnung (Felder vorwärts)</label>
                                                        <input type="number" class="form-control" id="reward_forward" 
                                                               value="5" min="1" max="10" 
                                                               onchange="updateFieldMinigameConfig('reward_forward', this.value)">
                                                        <small class="text-muted">Anzahl Felder bei Sieg</small>
                                                    </div>
                                                </div>
                                                <div class="col-md-4">
                                                    <div class="form-group">
                                                        <label for="default_mode">Standard-Modus</label>
                                                        <select class="form-control" id="default_mode" 
                                                                onchange="updateFieldMinigameConfig('default_mode', this.value)">
                                                            <option value="random">Zufällig</option>
                                                            <option value="team_vs_all">Team vs Alle</option>
                                                            <option value="team_vs_team">Team vs Team</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="col-md-4">
                                                    <div class="form-group">
                                                        <label for="auto_start_timer">Auto-Start Timer (Sekunden)</label>
                                                        <input type="number" class="form-control" id="auto_start_timer" 
                                                               value="5" min="0" max="30" 
                                                               onchange="updateFieldMinigameConfig('auto_start_timer', this.value)">
                                                        <small class="text-muted">0 = Deaktiviert</small>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endif %}

                        <!-- Formular-Aktionen -->
                        <div class="form-actions">
                            <div class="d-flex justify-content-between">
                                <div>
                                    {{ form.submit(class="btn btn-success btn-lg") }}
                                    <a href="{{ url_for('admin.manage_fields') }}" class="btn btn-secondary btn-lg ml-2">
                                        Abbrechen
                                    </a>
                                </div>
                                <div>
                                    {% if config and config.field_type not in ['start', 'goal', 'normal'] %}
                                        <button type="button" class="btn btn-outline-danger" 
                                                onclick="confirmDeleteField('{{ config.field_type }}')">
                                            <i class="fas fa-trash-alt"></i> Feld-Typ löschen
                                        </button>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        
        <!-- Sidebar mit Vorschau und Hilfe -->
        <div class="col-lg-4">
            <!-- Live-Vorschau -->
            <div class="card mb-4">
                <div class="card-header bg-info text-white">
                    <h6 class="mb-0">
                        <i class="fas fa-eye"></i> Live-Vorschau
                    </h6>
                </div>
                <div class="card-body text-center">
                    <div class="field-preview-container mb-3">
                        <div class="field-preview" id="field-preview-element" 
                             style="width: 60px; height: 60px; border-radius: 50%; margin: 0 auto; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.5em; font-weight: bold; border: 3px solid #333;">
                            {{ form.icon.data if form.icon.data else '?' }}
                        </div>
                    </div>
                    <h6 id="preview-name">{{ form.display_name.data or field_type }}</h6>
                    <p class="text-muted small" id="preview-description">
                        {{ form.description.data or 'Keine Beschreibung' }}
                    </p>
                    <div class="preview-details">
                        <span class="badge badge-secondary" id="preview-frequency">
                            Häufigkeit wird berechnet...
                        </span>
                    </div>
                </div>
            </div>

            <!-- Hilfe und Tipps -->
            <div class="card mb-4">
                <div class="card-header bg-warning text-dark">
                    <h6 class="mb-0">
                        <i class="fas fa-lightbulb"></i> Tipps und Hilfe
                    </h6>
                </div>
                <div class="card-body">
                    <h6>Häufigkeits-Typen:</h6>
                    <ul class="small">
                        <li><strong>Modulo:</strong> Alle X Felder (z.B. alle 15 Felder)</li>
                        <li><strong>Feste Positionen:</strong> Nur an bestimmten Positionen</li>
                        <li><strong>Wahrscheinlichkeit:</strong> Zufällige Verteilung mit %</li>
                        <li><strong>Standard:</strong> Alle nicht anders zugewiesenen Felder</li>
                    </ul>
                    
                    <h6 class="mt-3">Farb-Tipps:</h6>
                    <ul class="small">
                        <li><strong>Hauptfarbe:</strong> Grundfarbe des Feldes</li>
                        <li><strong>Effektfarbe:</strong> Für Glühen und Hervorhebungen</li>
                        <li>Verwenden Sie kontrastierende Farben für bessere Sichtbarkeit</li>
                    </ul>
                    
                    {% if field_type in ['catapult_forward', 'catapult_backward'] %}
                    <h6 class="mt-3">Katapult-Felder:</h6>
                    <ul class="small">
                        <li>Min/Max Distanz bestimmt die Sprungweite</li>
                        <li>Vorwärts: Positive Bewegung</li>
                        <li>Rückwärts: Negative Bewegung</li>
                    </ul>
                    {% elif field_type == 'barrier' %}
                    <h6 class="mt-3">Sperren-Feld:</h6>
                    <ul class="small">
                        <li><strong>Negative Zahlen:</strong> <code>-3</code> = höchstens 3</li>
                        <li><strong>Plus-Notation:</strong> <code>5+</code> = mindestens 5</li>
                        <li><strong>Einzelne Zahl:</strong> <code>6</code> = nur die 6</li>
                        <li><strong>Liste:</strong> <code>2,4,6</code> = mehrere Zahlen</li>
                        <li>Je weniger Zahlen, desto schwerer!</li>
                    </ul>
                    {% elif field_type == 'player_swap' %}
                    <h6 class="mt-3">Spieler-Tausch:</h6>
                    <ul class="small">
                        <li>Min. Abstand verhindert Tausch mit nahen Teams</li>
                        <li>Empfohlen: 3+ Felder Abstand</li>
                    </ul>
                    {% endif %}
                </div>
            </div>

            <!-- Häufigkeits-Rechner -->
            <div class="card">
                <div class="card-header bg-success text-white">
                    <h6 class="mb-0">
                        <i class="fas fa-calculator"></i> Häufigkeits-Rechner
                    </h6>
                </div>
                <div class="card-body">
                    <div id="frequency-calculator">
                        <p class="small text-muted">Auf einem Spielfeld mit 73 Feldern:</p>
                        <div id="calculation-result">
                            <span class="badge badge-info">Wird berechnet...</span>
                        </div>
                    </div>
                </div>
            </div>
            </div>
        </div>
    </div>
</div>


<script>
document.addEventListener('DOMContentLoaded', function() {
    // Live-Vorschau Updates
    const iconInput = document.getElementById('{{ form.icon.id }}');
    const displayNameInput = document.getElementById('{{ form.display_name.id }}');
    const descriptionInput = document.getElementById('{{ form.description.id }}');
    const colorInput = document.getElementById('color_hex');
    const emissionInput = document.getElementById('emission_hex');
    const frequencyTypeSelect = document.getElementById('frequency_type');
    const frequencyValueInput = document.getElementById('frequency_value');
    
    const previewElement = document.getElementById('field-preview-element');
    const previewName = document.getElementById('preview-name');
    const previewDescription = document.getElementById('preview-description');
    const previewFrequency = document.getElementById('preview-frequency');
    
    // Icon Preview Update
    if (iconInput) {
        iconInput.addEventListener('input', function() {
            const iconPreview = document.getElementById('icon-preview');
            const icon = this.value || '❓';
            iconPreview.textContent = icon;
            previewElement.textContent = icon;
        });
    }
    
    // Name Preview Update
    if (displayNameInput) {
        displayNameInput.addEventListener('input', function() {
            previewName.textContent = this.value || '{{ field_type }}';
        });
    }
    
    // Description Preview Update
    if (descriptionInput) {
        descriptionInput.addEventListener('input', function() {
            previewDescription.textContent = this.value || 'Keine Beschreibung';
        });
    }
    
    // Color Preview Updates
    if (colorInput) {
        colorInput.addEventListener('input', function() {
            const color = this.value;
            document.getElementById('color-preview').style.backgroundColor = color;
            previewElement.style.backgroundColor = color;
        });
    }
    
    if (emissionInput) {
        emissionInput.addEventListener('input', function() {
            const color = this.value;
            document.getElementById('emission-preview').style.backgroundColor = color;
            previewElement.style.boxShadow = `0 4px 8px rgba(0,0,0,0.3), 0 0 15px ${color}`;
        });
    }
    
    // Frequency Type Change Handler
    if (frequencyTypeSelect) {
        frequencyTypeSelect.addEventListener('change', updateFrequencyUI);
        updateFrequencyUI(); // Initial call
    }
    
    if (frequencyValueInput) {
        frequencyValueInput.addEventListener('input', calculateFrequency);
    }
    
    function updateFrequencyUI() {
        const type = frequencyTypeSelect.value;
        const fixedPositionsGroup = document.getElementById('fixed_positions_group');
        const frequencyValueLabel = document.getElementById('frequency_value_label');
        const frequencyHelp = document.getElementById('frequency_help');
        
        if (type === 'fixed_positions') {
            fixedPositionsGroup.style.display = 'block';
            frequencyValueLabel.textContent = 'Anzahl Positionen';
            frequencyHelp.textContent = 'Anzahl der fest definierten Positionen';
        } else {
            fixedPositionsGroup.style.display = 'none';
            if (type === 'modulo') {
                frequencyValueLabel.textContent = 'Modulo-Wert';
                frequencyHelp.textContent = 'Alle X Felder (z.B. 15 = alle 15 Felder)';
            } else if (type === 'probability') {
                frequencyValueLabel.textContent = 'Wahrscheinlichkeit (%)';
                frequencyHelp.textContent = 'Wahrscheinlichkeit in Prozent (0-100)';
            } else {
                frequencyValueLabel.textContent = 'Wert';
                frequencyHelp.textContent = 'Bestimmt die Häufigkeit des Feld-Typs';
            }
        }
        
        calculateFrequency();
    }
    
    function calculateFrequency() {
        const type = frequencyTypeSelect.value;
        const value = parseInt(frequencyValueInput.value) || 0;
        const totalFields = 73;
        let resultText = '';
        let count = 0;
        
        if (type === 'modulo' && value > 0) {
            count = Math.floor(totalFields / value);
            const percentage = ((count / totalFields) * 100).toFixed(1);
            resultText = `${count} Felder (${percentage}%)`;
            previewFrequency.textContent = `Alle ${value} Felder`;
            previewFrequency.className = 'badge badge-primary';
        } else if (type === 'fixed_positions') {
            count = value;
            const percentage = ((count / totalFields) * 100).toFixed(1);
            resultText = `${count} Felder (${percentage}%)`;
            previewFrequency.textContent = `${count} feste Positionen`;
            previewFrequency.className = 'badge badge-info';
        } else if (type === 'probability') {
            count = Math.round((totalFields * value) / 100);
            resultText = `~${count} Felder (${value}%)`;
            previewFrequency.textContent = `${value}% Wahrscheinlichkeit`;
            previewFrequency.className = 'badge badge-warning';
        } else if (type === 'default') {
            resultText = 'Alle übrigen Felder';
            previewFrequency.textContent = 'Standard-Felder';
            previewFrequency.className = 'badge badge-light';
        } else {
            resultText = 'Unbekannt';
            previewFrequency.textContent = 'Wird berechnet...';
            previewFrequency.className = 'badge badge-secondary';
        }
        
        document.getElementById('calculation-result').innerHTML = `
            <div class="badge badge-success">${resultText}</div>
        `;
    }
    
    // Initial calculations
    calculateFrequency();
    
    // Load field minigame data if this is a minigame field
    if ('{{ field_type }}' === 'minigame') {
        loadFieldMinigameData();
        loadFieldMinigameConfig();
    }
});

// Field Minigame Management Functions
function loadFieldMinigameData() {
    fetch('/admin/api/field_minigame_counts')
        .then(response => response.json())
        .then(data => {
            document.getElementById('team-vs-all-count').textContent = data.team_vs_all || 0;
            document.getElementById('team-vs-team-count').textContent = data.team_vs_team || 0;
        })
        .catch(error => {
            console.error('Error loading field minigame data:', error);
            document.getElementById('team-vs-all-count').textContent = 'Fehler';
            document.getElementById('team-vs-team-count').textContent = 'Fehler';
        });
}

function loadFieldMinigameConfig() {
    fetch('/admin/api/field_minigame_config')
        .then(response => response.json())
        .then(config => {
            const fieldConfig = config.field_minigames || {};
            const modes = fieldConfig.modes || {};
            
            // Load reward settings
            const teamVsAllReward = modes.team_vs_all?.reward_forward || 5;
            const teamVsTeamReward = modes.team_vs_team?.reward_forward || 5;
            
            // Set form values
            document.getElementById('reward_forward').value = teamVsAllReward;
            document.getElementById('default_mode').value = fieldConfig.default_mode || 'random';
            document.getElementById('auto_start_timer').value = fieldConfig.game_flow?.auto_start_timer || 5;
        })
        .catch(error => {
            console.error('Error loading field minigame config:', error);
        });
}

function updateFieldMinigameConfig(key, value) {
    const data = {
        key: key,
        value: value
    };
    
    fetch('/admin/api/field_minigame_config', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': document.querySelector('input[name="csrf_token"]').value
        },
        body: JSON.stringify(data)
    })
    .then(response => response.json())
    .then(result => {
        if (result.success) {
            // Show success message
            showAlert('Einstellungen gespeichert', 'success');
        } else {
            showAlert('Fehler beim Speichern: ' + result.message, 'danger');
        }
    })
    .catch(error => {
        console.error('Error updating config:', error);
        showAlert('Fehler beim Speichern der Einstellungen', 'danger');
    });
}

function openMinigameEditor(mode) {
    // Open modal for minigame management
    const modal = document.createElement('div');
    modal.className = 'modal fade';
    modal.id = 'minigameEditorModal';
    modal.innerHTML = `
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-gamepad"></i> 
                        ${mode === 'team_vs_all' ? 'Team vs Alle' : 'Team vs Team'} Minigames
                    </h5>
                    <button type="button" class="close" data-dismiss="modal">
                        <span>&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header bg-primary text-white">
                                    <h6 class="mb-0">
                                        <i class="fas fa-list"></i> Vorhandene Minigames
                                    </h6>
                                </div>
                                <div class="card-body">
                                    <div id="existing-minigames">
                                        <div class="text-center">
                                            <div class="spinner-border text-primary" role="status">
                                                <span class="sr-only">Lädt...</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header bg-success text-white">
                                    <h6 class="mb-0">
                                        <i class="fas fa-plus"></i> Neues Minigame erstellen
                                    </h6>
                                </div>
                                <div class="card-body">
                                    <div id="minigame-form">
                                        <div class="form-group">
                                            <label for="game_title">Spiel-Titel</label>
                                            <input type="text" class="form-control" id="game_title" placeholder="z.B. Schnellste Reaktion" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="game_instructions">Anleitung</label>
                                            <textarea class="form-control" id="game_instructions" rows="3" placeholder="Detaillierte Anleitung für das Spiel" required></textarea>
                                        </div>
                                        <div class="form-group">
                                            <label for="player_count_type">Spieler-Auswahl</label>
                                            <select class="form-control" id="player_count_type" onchange="updatePlayerCountOptions()">
                                                <option value="number">Bestimmte Anzahl</option>
                                                <option value="whole_team">Ganzes Team</option>
                                            </select>
                                        </div>
                                        <div class="form-group" id="player_count_number_group">
                                            <label for="player_count">Anzahl Spieler pro Team</label>
                                            <input type="number" class="form-control" id="player_count" value="1" min="1" max="10" placeholder="z.B. 1, 2, 3">
                                            <small class="text-muted">Anzahl der Spieler die pro Team ausgelost werden</small>
                                        </div>
                                        <button type="button" class="btn btn-success" onclick="saveMinigame('${mode}')">
                                            <i class="fas fa-save"></i> Minigame speichern
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Schließen</button>
                </div>
            </div>
        </div>
    `;
    
    document.body.appendChild(modal);
    $('#minigameEditorModal').modal('show');
    
    // Setup event handlers
    setupMinigameEditor(mode);
    loadExistingMinigames(mode);
}

function setupMinigameEditor(mode) {
    // Cleanup modal when closed
    $('#minigameEditorModal').on('hidden.bs.modal', function () {
        document.body.removeChild(document.getElementById('minigameEditorModal'));
    });
}


function loadExistingMinigames(mode) {
    fetch(`/admin/api/field_minigames/${mode}`)
        .then(response => response.json())
        .then(data => {
            const container = document.getElementById('existing-minigames');
            if (data.minigames && data.minigames.length > 0) {
                container.innerHTML = '';
                data.minigames.forEach(minigame => {
                    const card = document.createElement('div');
                    card.className = 'card mb-2';
                    card.innerHTML = `
                        <div class="card-body py-2">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="mb-1">
                                        <i class="fas fa-gamepad"></i>
                                        ${minigame.title}
                                    </h6>
                                    <small class="text-muted">
                                        ${minigame.instructions || 'Keine Anleitung'}
                                    </small>
                                </div>
                                <div>
                                    <button class="btn btn-sm btn-outline-primary" onclick="editMinigame('${mode}', '${minigame.id}')">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn btn-sm btn-outline-danger" onclick="deleteMinigame('${mode}', '${minigame.id}')">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                    container.appendChild(card);
                });
            } else {
                container.innerHTML = '<p class="text-muted text-center">Keine Minigames vorhanden</p>';
            }
        })
        .catch(error => {
            console.error('Error loading minigames:', error);
            document.getElementById('existing-minigames').innerHTML = '<p class="text-danger">Fehler beim Laden</p>';
        });
}

function updatePlayerCountOptions() {
    const type = document.getElementById('player_count_type').value;
    const numberGroup = document.getElementById('player_count_number_group');
    
    if (type === 'whole_team') {
        numberGroup.style.display = 'none';
    } else {
        numberGroup.style.display = 'block';
    }
}

function saveMinigame(mode) {
    const playerCountType = document.getElementById('player_count_type').value;
    let playerCount;
    
    if (playerCountType === 'whole_team') {
        playerCount = -1; // Spezialwert für "ganzes Team"
    } else {
        playerCount = parseInt(document.getElementById('player_count').value);
    }
    
    let data = {
        type: "game",
        title: document.getElementById('game_title').value,
        instructions: document.getElementById('game_instructions').value,
        player_count: playerCount,
        materials: "Keine"
    };
    
    // Validierung
    if (!data.title || !data.instructions) {
        showAlert('Bitte alle Pflichtfelder ausfüllen', 'warning');
        return;
    }
    
    fetch(`/admin/api/field_minigames/${mode}`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': document.querySelector('input[name="csrf_token"]').value
        },
        body: JSON.stringify(data)
    })
    .then(response => response.json())
    .then(result => {
        if (result.success) {
            showAlert('Minigame gespeichert', 'success');
            loadExistingMinigames(mode);
            loadFieldMinigameData(); // Update counts
            clearForm();
        } else {
            showAlert('Fehler beim Speichern: ' + result.message, 'danger');
        }
    })
    .catch(error => {
        console.error('Error saving minigame:', error);
        showAlert('Fehler beim Speichern', 'danger');
    });
}

function editMinigame(mode, id) {
    // Erst die Daten des Minigames laden
    fetch(`/admin/api/field_minigames/${mode}`)
        .then(response => response.json())
        .then(data => {
            const minigame = data.minigames.find(m => m.id === id);
            if (!minigame) {
                showAlert('Minigame nicht gefunden', 'danger');
                return;
            }
            
            // Formular mit vorhandenen Daten befüllen
            document.getElementById('game_title').value = minigame.title || '';
            document.getElementById('game_instructions').value = minigame.instructions || '';
            
            // Player count handling
            const playerCount = minigame.player_count || 1;
            if (playerCount === -1) {
                // Ganzes Team
                document.getElementById('player_count_type').value = 'whole_team';
                updatePlayerCountOptions();
            } else {
                // Bestimmte Anzahl
                document.getElementById('player_count_type').value = 'number';
                document.getElementById('player_count').value = playerCount;
                updatePlayerCountOptions();
            }
            
            showAlert(`Bearbeite "${minigame.title}"`, 'info');
            
            // Change the save button to update mode
            const saveButton = document.querySelector('button[onclick^="saveMinigame"]');
            saveButton.onclick = () => updateMinigame(mode, id);
            saveButton.innerHTML = '<i class="fas fa-save"></i> Änderungen speichern';
        })
        .catch(error => {
            console.error('Error loading minigame for editing:', error);
            showAlert('Fehler beim Laden des Minigames', 'danger');
        });
}

function updateMinigame(mode, id) {
    const playerCountType = document.getElementById('player_count_type').value;
    let playerCount;
    
    if (playerCountType === 'whole_team') {
        playerCount = -1; // Spezialwert für "ganzes Team"
    } else {
        playerCount = parseInt(document.getElementById('player_count').value);
    }
    
    let data = {
        type: "game",
        title: document.getElementById('game_title').value,
        instructions: document.getElementById('game_instructions').value,
        player_count: playerCount,
        materials: "Keine"
    };
    
    // Validierung
    if (!data.title || !data.instructions) {
        showAlert('Bitte alle Pflichtfelder ausfüllen', 'warning');
        return;
    }
    
    fetch(`/admin/api/field_minigames/${mode}/${id}`, {
        method: 'PUT',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': document.querySelector('input[name="csrf_token"]').value
        },
        body: JSON.stringify(data)
    })
    .then(response => response.json())
    .then(result => {
        if (result.success) {
            showAlert('Minigame aktualisiert', 'success');
            loadExistingMinigames(mode);
            loadFieldMinigameData(); // Update counts
            resetFormToCreateMode(mode);
        } else {
            showAlert('Fehler beim Aktualisieren: ' + result.message, 'danger');
        }
    })
    .catch(error => {
        console.error('Error updating minigame:', error);
        showAlert('Fehler beim Aktualisieren', 'danger');
    });
}

function resetFormToCreateMode(mode) {
    clearForm();
    const saveButton = document.querySelector('button[onclick^="updateMinigame"], button[onclick^="saveMinigame"]');
    saveButton.onclick = () => saveMinigame(mode);
    saveButton.innerHTML = '<i class="fas fa-save"></i> Minigame speichern';
}

function deleteMinigame(mode, id) {
    if (confirm('Minigame wirklich löschen?')) {
        fetch(`/admin/api/field_minigames/${mode}/${id}`, {
            method: 'DELETE',
            headers: {
                'X-CSRFToken': document.querySelector('input[name="csrf_token"]').value
            }
        })
        .then(response => response.json())
        .then(result => {
            if (result.success) {
                showAlert('Minigame gelöscht', 'success');
                loadExistingMinigames(mode);
                loadFieldMinigameData(); // Update counts
            } else {
                showAlert('Fehler beim Löschen: ' + result.message, 'danger');
            }
        })
        .catch(error => {
            console.error('Error deleting minigame:', error);
            showAlert('Fehler beim Löschen', 'danger');
        });
    }
}

function clearForm() {
    document.getElementById('game_title').value = '';
    document.getElementById('game_instructions').value = '';
    document.getElementById('player_count_type').value = 'number';
    document.getElementById('player_count').value = '1';
    updatePlayerCountOptions();
}

function showAlert(message, type) {
    const alertDiv = document.createElement('div');
    alertDiv.className = `alert alert-${type} alert-dismissible fade show`;
    alertDiv.innerHTML = `
        ${message}
        <button type="button" class="close" data-dismiss="alert">
            <span>&times;</span>
        </button>
    `;
    
    const container = document.querySelector('.card-body');
    container.insertBefore(alertDiv, container.firstChild);
    
    setTimeout(() => {
        alertDiv.remove();
    }, 5000);
}

function confirmDeleteField(fieldType) {
    if (confirm(`Möchten Sie den Feld-Typ "${fieldType}" wirklich löschen? Diese Aktion kann nicht rückgängig gemacht werden.`)) {
        // Create and submit delete form
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = `/admin/delete_field/${fieldType}`;
        
        const csrfToken = document.querySelector('input[name="csrf_token"]').value;
        const csrfInput = document.createElement('input');
        csrfInput.type = 'hidden';
        csrfInput.name = 'csrf_token';
        csrfInput.value = csrfToken;
        
        form.appendChild(csrfInput);
        document.body.appendChild(form);
        form.submit();
    }
}
</script>
{% endblock %}